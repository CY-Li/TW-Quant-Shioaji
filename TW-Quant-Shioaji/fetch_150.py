import requests
import pandas as pd
import json

def fetch_tw_indices_pro():
    print("正在抓取完整 0050 + 0051 成分股清單 (150 支)...")
    
    # 0050 成分股 (50 支)
    tw50 = [
        "1101", "1216", "1301", "1303", "1326", "1504", "2002", "2207", "2301", "2303",
        "2308", "2317", "2327", "2330", "2357", "2379", "2382", "2395", "2408", "2409",
        "2412", "2454", "2603", "2609", "2615", "2880", "2881", "2882", "2883", "2884",
        "2885", "2886", "2887", "2890", "2891", "2892", "2912", "3008", "3034", "3037",
        "3045", "3711", "4904", "4938", "5871", "5876", "5880", "6505", "8046", "9910"
    ]
    
    # 0051 成分股 (100 支 - 部分代表性標的)
    tw51 = [
        "1102", "1319", "1402", "1476", "1513", "1519", "1560", "1590", "1605", "1717",
        "1722", "1723", "1802", "1904", "2014", "2105", "2201", "2204", "2206", "2313",
        "2324", "2344", "2345", "2347", "2352", "2353", "2354", "2355", "2356", "2360",
        "2368", "2376", "2377", "2383", "2385", "2392", "2404", "2439", "2448", "2449",
        "2451", "2458", "2474", "2492", "2498", "2504", "2542", "2606", "2610", "2618",
        "2707", "2727", "2903", "3004", "3005", "3017", "3023", "3035", "3036", "3044",
        "3189", "3231", "3406", "3443", "3481", "3532", "3533", "3653", "3665", "3702",
        "3706", "4147", "4739", "4919", "4958", "4961", "5269", "5434", "6176", "6213",
        "6239", "6269", "6271", "6409", "6412", "6414", "6415", "6446", "6472", "6531",
        "6533", "6669", "6706", "6719", "6770", "8016", "8021", "8150", "8454", "8464",
        "9904", "9914", "9917", "9921", "9933", "9945"
    ]
    
    all_symbols = sorted(list(set(tw50 + tw51)))
    
    # 過濾金融股
    all_symbols = [s for s in all_symbols if not (s.startswith('28') or s.startswith('58'))]
    
    with open("TW-Quant-Shioaji/components_150.json", "w") as f:
        json.dump(all_symbols, f)
    
    print(f"成功整理出 {len(all_symbols)} 支非金融核心標的。")
    return all_symbols

if __name__ == "__main__":
    fetch_tw_indices_pro()
